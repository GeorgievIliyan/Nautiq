{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautiq | Табло</title>
    <!--Favicon-->
    <link rel="icon" type="image/x-icon" href="{% static 'images/logo/logo.svg' %}">
    <!--Bootstrap Icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <!--CSS-->
    <link rel="stylesheet" href="{% static 'dashboard.css' %}?v=2">
    <link rel="stylesheet" href="{% static 'nav.css' %}">
</head>
<style>
    .dashboard-top{
        background-size: cover !important;
        background: url('{% static "images/login_img.jpg" %}') no-repeat center center;
    }
</style>
<body>
    <!--Navigation bar-->
    {% include 'app/components/navbar.html' %}
    <div class="dashboard-top">
        <div class="content">
            <h1><span class="regular">Здравей,</span> {{ user.username }}!</h1>
        </div>
    </div>

    <!--
    class MonthlyStats(models.Model):
    user = models.ForeignKey(UserProfile, on_delete=models.CASCADE, related_name='monthly_stats')
    month = models.DateField()
    tasks_completed = models.PositiveIntegerField(default=0)
    xp = models.PositiveIntegerField(default=0)
    -->

    <div id="popup-alert-container"></div>

    <div class="dashboard-wrapper">
        <div class="leaderboard">
            <h2>Класация</h2>
                <div class="leaderboard-top">
                    {% for lb in leaderboard|slice:":3" %}
                    <div class="leaderboard-top-box">
                        <div class="medal {% if forloop.counter == 1 %}medal-gold{% elif forloop.counter == 2 %}medal-silver{% else %}medal-bronze{% endif %}">
                            <i class="bi bi-trophy"></i>
                        </div>
                        <p>{{ lb.username }}</p>
                        <span class="top-points">{{ lb.score }}k</span>
                    </div>
                    {% endfor %}
                </div>

                <h3>Пълна класация</h3>
                <div class="full-leaderboard">
                    {% for lb in leaderboard %}
                    <div class="leaderboard-place">
                        <div class="account-wrappper">
                            <span class="place">{{ lb.place }}</span>
                            <img src="{{ lb.profile_img }}" alt="user-pfp" class="user-pfp">
                            <div class="user-wrapper">
                                <div class="flex-row">
                                    <span class="username">{{ lb.username }}</span>
                                    {% if lb.is_current_user %}
                                        <span class="you-tag">Вие</span>
                                    {% endif %}
                                </div>
                                <span class="user-stats">{{ lb.tasks_completed }}</span>
                            </div>
                        </div>
                        <span class="score">{{ lb.score }}k</span>
                    </div>
                    {% endfor %}
                </div>
        </div>

        <div class="stats-wrapper">
            <div class="stats-box">
                <div class="stats-top">
                    <span class="top-title">Изпълнени мисии</span>
                    <div class="icon-box">
                        <i class="bi bi-bullseye"></i>
                    </div>
                </div>
                <div class="stats-box-content">
                    <div class="stats-number">
                        {{ monthly_stats.tasks_completed }}
                    </div>
                    <div class="stats-tag">+20% бла бла</div>
                </div>
            </div>
            
            <div class="stats-box">
                <div class="stats-top">
                    <span class="top-title">XP точки</span>
                    <div class="icon-box">
                        <i class="bi bi-bullseye"></i>
                    </div>
                </div>
                <div class="stats-box-content">
                    <div class="stats-number">
                        {{ profile.xp }}
                    </div>
                    <div class="stats-tag">+12% бла бла</div>
                </div>
            </div>

            <div class="stats-box gap-24 d-flex-column">
                <div class="text-wrapper">
                    <h3>Готов ли си?</h3>
                    <p>
                        Започни да трупаш точки и да<br>
                        се конкураш с останалите!
                    </p>
                </div>
                <a href="{% url 'tasks' %}" class="btn-small-for-box">
                    Мисии
                </a>
            </div>
        </div>
    </div>
</body>
<script src="{% static 'js/closeAlert.js' %}"></script>
</html>